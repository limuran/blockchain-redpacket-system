# ğŸ§§ é“¾ä¸Šçº¢åŒ…ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å»ä¸­å¿ƒåŒ–çº¢åŒ…ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ™ºèƒ½åˆçº¦ã€å‰ç«¯ç•Œé¢ã€è®°å½•è¿½è¸ªå’Œå­å›¾ç´¢å¼•ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
blockchain-data-system/
â”œâ”€â”€ contracts/
â”‚   â””â”€â”€ RedPackage.sol           # çº¢åŒ…æ™ºèƒ½åˆçº¦
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ wallet/
â”‚   â”‚   â”‚   â””â”€â”€ WalletHeader.js  # é’±åŒ…è¿æ¥ç»„ä»¶ï¼ˆå«ENSï¼‰
â”‚   â”‚   â””â”€â”€ redpacket/
â”‚   â”‚       â”œâ”€â”€ RedPacketPage.js    # ä¸»é¡µé¢
â”‚   â”‚       â”œâ”€â”€ CreateRedPacket.js  # å‘çº¢åŒ…ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ GrabRedPacket.js    # æŠ¢çº¢åŒ…ç»„ä»¶
â”‚   â”‚       â””â”€â”€ RedPacketRecords.js # çº¢åŒ…è®°å½•ç»„ä»¶ â­NEW
â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â””â”€â”€ WalletContext.js     # é’±åŒ…çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useRedPacket.js      # åˆçº¦äº¤äº’Hook
â””â”€â”€ subgraph/
    â”œâ”€â”€ redpacket-schema.graphql # å­å›¾Schema
    â””â”€â”€ redpacket-subgraph.yaml  # å­å›¾é…ç½®
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. éƒ¨ç½²æ™ºèƒ½åˆçº¦

```bash
# ç¼–è¯‘åˆçº¦
npx hardhat compile

# éƒ¨ç½²åˆ°æµ‹è¯•ç½‘ï¼ˆSepoliaï¼‰
npx hardhat run scripts/deploy.js --network sepolia

# éƒ¨ç½²åˆ°ä¸»ç½‘
npx hardhat run scripts/deploy.js --network mainnet
```

### 2. é…ç½®å‰ç«¯

1. å®‰è£…ä¾èµ–ï¼š
```bash
npm install ethers
```

2. æ›´æ–° `src/App.js` å¼•å…¥çº¢åŒ…ç³»ç»Ÿï¼š
```javascript
import RedPacketPage from './components/redpacket/RedPacketPage';

function App() {
  return (
    <div className="App">
      <RedPacketPage />
    </div>
  );
}
```

### 3. éƒ¨ç½²å­å›¾ï¼ˆå¯é€‰ä½†æ¨èï¼‰

1. å®‰è£… Graph CLIï¼š
```bash
npm install -g @graphprotocol/graph-cli
```

2. åˆ›å»ºå­å›¾ï¼š
```bash
graph init --studio redpacket-subgraph
```

3. é…ç½®å­å›¾ï¼š
   - æ›´æ–° `redpacket-subgraph.yaml` ä¸­çš„åˆçº¦åœ°å€
   - æ›´æ–°ç½‘ç»œé…ç½®
   - æ·»åŠ åˆçº¦ABIåˆ° `abis/` ç›®å½•

4. ç”Ÿæˆä»£ç å¹¶éƒ¨ç½²ï¼š
```bash
graph codegen
graph build
graph deploy --studio redpacket-subgraph
```

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ™ºèƒ½åˆçº¦åŠŸèƒ½
- âœ… åˆ›å»ºçº¢åŒ…ï¼ˆå‡ç­‰/éšæœºåˆ†é…ï¼‰
- âœ… æŠ¢çº¢åŒ…ï¼ˆé˜²é‡å¤æŠ¢å–ï¼‰
- âœ… 24å°æ—¶åé€€æ¬¾æœºåˆ¶
- âœ… å®Œæ•´çš„äº‹ä»¶æ—¥å¿—
- âœ… å®‰å…¨æ£€æŸ¥å’Œé”™è¯¯å¤„ç†

### å‰ç«¯åŠŸèƒ½
- âœ… é’±åŒ…è¿æ¥ï¼ˆMetaMaskï¼‰
- âœ… ENS åç§°æ˜¾ç¤º
- âœ… ç½‘ç»œçŠ¶æ€æ£€æµ‹
- âœ… å‘çº¢åŒ…ç•Œé¢
- âœ… æŠ¢çº¢åŒ…ç•Œé¢
- âœ… **å®Œæ•´çš„çº¢åŒ…è®°å½•è¿½è¸ª** â­NEW
- âœ… å®æ—¶äº‹ä»¶ç›‘å¬
- âœ… äº¤æ˜“çŠ¶æ€è·Ÿè¸ª
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

### ğŸ“Š çº¢åŒ…è®°å½•åŠŸèƒ½ï¼ˆæ–°å¢ï¼‰
- âœ… **æˆ‘å‘å‡ºçš„çº¢åŒ…**ï¼š
  - çº¢åŒ…åŸºæœ¬ä¿¡æ¯ï¼ˆé‡‘é¢ã€æ•°é‡ã€ç±»å‹ï¼‰
  - å½“å‰çŠ¶æ€ï¼ˆè¿›è¡Œä¸­/å·²æŠ¢å®Œ/å·²ç»“æŸï¼‰
  - æŠ¢å¤ºè®°å½•ï¼ˆè°æŠ¢äº†å¤šå°‘ï¼‰
  - Gasè´¹ç”¨è¯¦æƒ…
  - äº¤æ˜“å“ˆå¸Œé“¾æ¥
- âœ… **æˆ‘æŠ¢åˆ°çš„çº¢åŒ…**ï¼š
  - è·å¾—çš„é‡‘é¢æ˜ç»†
  - çº¢åŒ…åˆ›å»ºè€…ä¿¡æ¯
  - æŠ¢å¤ºæ—¶é—´è®°å½•
  - Gasè´¹ç”¨ç»Ÿè®¡
- âœ… **ç»Ÿè®¡é¢æ¿**ï¼š
  - å‘å‡º/æŠ¢åˆ°çº¢åŒ…æ•°é‡
  - æ€»é‡‘é¢ç»Ÿè®¡ï¼ˆå‘å‡º/è·å¾—ï¼‰
  - ç´¯è®¡Gasè´¹ç”¨
  - æ”¶æ”¯å¹³è¡¡åˆ†æ
- âœ… **å®æ—¶æ•°æ®**ï¼š
  - è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
  - åŒºå—é“¾äº‹ä»¶ç›‘å¬
  - äº¤æ˜“è¯¦æƒ…æŸ¥è¯¢

### å­å›¾åŠŸèƒ½
- âœ… çº¢åŒ…æ•°æ®ç´¢å¼•
- âœ… ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
- âœ… å†å²è®°å½•æŸ¥è¯¢
- âœ… å®æ—¶æ•°æ®åŒæ­¥

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### å‘çº¢åŒ…æµç¨‹
1. è¿æ¥ MetaMask é’±åŒ…
2. è¾“å…¥éƒ¨ç½²çš„åˆçº¦åœ°å€
3. è®¾ç½®çº¢åŒ…å‚æ•°ï¼š
   - æ€»é‡‘é¢ï¼ˆETHï¼‰
   - çº¢åŒ…æ•°é‡ï¼ˆ1-100ï¼‰
   - ç±»å‹ï¼ˆå‡ç­‰/éšæœºï¼‰
   - ç¥ç¦è¯­ï¼ˆå¯é€‰ï¼‰
4. ç¡®è®¤äº¤æ˜“
5. è·å¾—çº¢åŒ…IDï¼Œåˆ†äº«ç»™å…¶ä»–äºº

### æŠ¢çº¢åŒ…æµç¨‹
1. è¿æ¥ MetaMask é’±åŒ…
2. è¾“å…¥åˆçº¦åœ°å€å’Œçº¢åŒ…ID
3. æŸ¥çœ‹çº¢åŒ…ä¿¡æ¯
4. ç‚¹å‡»æŠ¢çº¢åŒ…
5. ç¡®è®¤äº¤æ˜“è·å¾—éšæœºé‡‘é¢

### ğŸ“Š æŸ¥çœ‹è®°å½•æµç¨‹ï¼ˆæ–°å¢ï¼‰
1. è¿æ¥ MetaMask é’±åŒ…
2. è¾“å…¥åˆçº¦åœ°å€
3. ç‚¹å‡»"æˆ‘çš„è®°å½•"é€‰é¡¹å¡
4. æŸ¥çœ‹è¯¦ç»†çš„çº¢åŒ…ç»Ÿè®¡ï¼š
   - **å‘å‡ºçš„çº¢åŒ…**ï¼šæŸ¥çœ‹æ¯ä¸ªçº¢åŒ…çš„è¯¦ç»†çŠ¶æ€
   - **æŠ¢åˆ°çš„çº¢åŒ…**ï¼šæŸ¥çœ‹è·å¾—çš„é‡‘é¢è®°å½•
   - **Gasè´¹ç”¨**ï¼šæ‰€æœ‰äº¤æ˜“çš„Gasæ¶ˆè€—
   - **æ”¶æ”¯åˆ†æ**ï¼šæ€»ä½“ç›ˆäºæƒ…å†µ

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æé†’
- æ¯ä¸ªåœ°å€åªèƒ½æŠ¢ä¸€æ¬¡ç›¸åŒçš„çº¢åŒ…
- åˆ›å»ºè€…ä¸èƒ½æŠ¢è‡ªå·±çš„çº¢åŒ…
- å»ºè®®å…ˆåœ¨æµ‹è¯•ç½‘æµ‹è¯•
- æ³¨æ„Gasè´¹ç”¨ï¼ˆè®°å½•æ¨¡å—ä¼šæ˜¾ç¤ºè¯¦ç»†è´¹ç”¨ï¼‰

### ç½‘ç»œæ”¯æŒ
- Ethereum ä¸»ç½‘
- Sepolia æµ‹è¯•ç½‘
- å…¶ä»–å…¼å®¹EVMçš„ç½‘ç»œ

### åˆçº¦é™åˆ¶
- æœ€å°çº¢åŒ…é‡‘é¢ï¼š0.001 ETH
- æœ€å¤§çº¢åŒ…æ•°é‡ï¼š100ä¸ª
- ç¥ç¦è¯­æœ€é•¿ï¼š200å­—ç¬¦
- é€€æ¬¾æ—¶é—´ï¼š24å°æ—¶å

## ğŸ¨ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ ·å¼
- æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ Tailwind CSS
- å¯åœ¨å„ç»„ä»¶æ–‡ä»¶ä¸­è‡ªå®šä¹‰æ ·å¼
- æ”¯æŒå“åº”å¼è®¾è®¡

### æ‰©å±•åŠŸèƒ½
- å¯æ·»åŠ æ›´å¤šçº¢åŒ…ç±»å‹
- é›†æˆå…¶ä»–é’±åŒ…ï¼ˆWalletConnectç­‰ï¼‰
- æ·»åŠ çº¢åŒ…å†å²é¡µé¢
- é›†æˆé€šçŸ¥ç³»ç»Ÿ
- **å¯¼å‡ºè®°å½•ä¸ºCSV** ğŸ“Š
- **çº¢åŒ…æ•°æ®å¯è§†åŒ–å›¾è¡¨** ğŸ“ˆ

## ğŸ“Š è®°å½•æ¨¡å—æŠ€æœ¯å®ç°

### æ•°æ®æº
```javascript
// ä»åŒºå—é“¾äº‹ä»¶è·å–æ•°æ®
const createdFilter = contract.filters.RedPackageCreated(null, account);
const grabbedFilter = contract.filters.RedPackageGrabbed(null, account);

// è·å–äº¤æ˜“è¯¦æƒ…å’ŒGasè´¹ç”¨
const txDetails = await getTransactionDetails(txHash);
const gasCost = ethers.formatEther(gasUsed * gasPrice);
```

### ç»Ÿè®¡è®¡ç®—
```javascript
// è®¡ç®—æ€»é‡‘é¢
const totalAmountCreated = records.reduce((sum, record) => 
  sum + parseFloat(record.totalAmount), 0
);

// è®¡ç®—Gasè´¹ç”¨
const totalGasUsed = records.reduce((sum, record) => 
  sum + parseFloat(record.gasCost), 0
);
```

### å®æ—¶æ›´æ–°
- ç›‘å¬åŒºå—é“¾äº‹ä»¶è‡ªåŠ¨åˆ·æ–°
- æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
- ç¼“å­˜æœºåˆ¶ä¼˜åŒ–æ€§èƒ½

## ğŸ“Š å­å›¾æŸ¥è¯¢ç¤ºä¾‹

```graphql
# æŸ¥è¯¢ç”¨æˆ·çº¢åŒ…ç»Ÿè®¡
{
  users(where: {address: "0x..."}) {
    address
    createdRedPackagesCount
    grabbedRedPackagesCount
    totalAmountCreated
    totalAmountGrabbed
  }
}

# æŸ¥è¯¢ç”¨æˆ·å‘å‡ºçš„çº¢åŒ…
{
  redPackages(where: {creator: "0x..."}) {
    id
    totalAmount
    remainingAmount
    isEqual
    message
    createTime
    grabRecords {
      grabber {
        address
      }
      amount
    }
  }
}

# æŸ¥è¯¢ç”¨æˆ·æŠ¢åˆ°çš„çº¢åŒ…
{
  grabRecords(where: {grabber: "0x..."}) {
    redPackage {
      id
      creator {
        address
      }
      message
    }
    amount
    timestamp
  }
}
```

## ğŸ¯ è®°å½•æ¨¡å—å±•ç¤ºå†…å®¹

### ğŸ“ˆ ç»Ÿè®¡å¡ç‰‡
- **å‘å‡ºçº¢åŒ…æ•°é‡**ï¼šåˆ›å»ºçš„çº¢åŒ…æ€»æ•°
- **æŠ¢åˆ°çº¢åŒ…æ•°é‡**ï¼šæˆåŠŸæŠ¢åˆ°çš„çº¢åŒ…æ•°
- **å‘å‡ºæ€»é¢**ï¼šåˆ›å»ºçº¢åŒ…çš„æ€»é‡‘é¢
- **è·å¾—æ€»é¢**ï¼šæŠ¢çº¢åŒ…è·å¾—çš„æ€»é‡‘é¢
- **Gasè´¹ç”¨**ï¼šæ‰€æœ‰äº¤æ˜“æ¶ˆè€—çš„Gasæ€»è´¹ç”¨

### ğŸ“‹ è¯¦ç»†è®°å½•
- **å‘å‡ºçš„çº¢åŒ…**ï¼š
  - çº¢åŒ…IDå’Œåˆ›å»ºæ—¶é—´
  - é‡‘é¢ã€æ•°é‡ã€ç±»å‹
  - å½“å‰çŠ¶æ€å’Œå‰©ä½™æƒ…å†µ
  - æŠ¢å¤ºè®°å½•åˆ—è¡¨
  - ç¥ç¦è¯­å†…å®¹
  - äº¤æ˜“å“ˆå¸Œå’ŒGasè´¹ç”¨
  
- **æŠ¢åˆ°çš„çº¢åŒ…**ï¼š
  - çº¢åŒ…IDå’ŒæŠ¢å¤ºæ—¶é—´
  - è·å¾—çš„å…·ä½“é‡‘é¢
  - åˆ›å»ºè€…åœ°å€
  - çº¢åŒ…å‰©ä½™çŠ¶æ€
  - äº¤æ˜“è¯¦æƒ…

### ğŸ”— å¤–éƒ¨é“¾æ¥
- æ¯ä¸ªäº¤æ˜“éƒ½æä¾› Etherscan é“¾æ¥
- ç›´æ¥è·³è½¬æŸ¥çœ‹åŒºå—é“¾è¯¦æƒ…
- æ”¯æŒä¸åŒç½‘ç»œçš„æµè§ˆå™¨

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ†˜ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•è·å–æµ‹è¯•ç½‘ETHï¼Ÿ**
A: è®¿é—® Sepolia æ°´é¾™å¤´è·å–æµ‹è¯•ETHã€‚

**Q: è®°å½•åŠ è½½å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ**
A: è®°å½•æ¨¡å—éœ€è¦æŸ¥è¯¢åŒºå—é“¾å†å²äº‹ä»¶ï¼Œé¦–æ¬¡åŠ è½½å¯èƒ½è¾ƒæ…¢ï¼Œåç»­è®¿é—®ä¼šæœ‰ç¼“å­˜ã€‚

**Q: Gasè´¹ç”¨æ˜¾ç¤ºä¸å‡†ç¡®ï¼Ÿ**
A: Gasè´¹ç”¨è®¡ç®—åŸºäºå®é™…äº¤æ˜“æ•°æ®ï¼Œå¯èƒ½å› ç½‘ç»œæ‹¥å µè€Œæœ‰æ‰€å·®å¼‚ã€‚

**Q: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°æŸä¸ªçº¢åŒ…çš„è®°å½•ï¼Ÿ**
A: ç¡®ä¿åˆçº¦åœ°å€æ­£ç¡®ï¼Œä¸”è¯¥çº¢åŒ…ç¡®å®æ˜¯ç”±å½“å‰é’±åŒ…åœ°å€åˆ›å»ºæˆ–æŠ¢å¤ºçš„ã€‚

**Q: å¦‚ä½•å¯¼å‡ºè®°å½•æ•°æ®ï¼Ÿ**
A: ç›®å‰æ”¯æŒå¤åˆ¶äº¤æ˜“å“ˆå¸ŒæŸ¥çœ‹è¯¦æƒ…ï¼Œåç»­ç‰ˆæœ¬å°†æ·»åŠ CSVå¯¼å‡ºåŠŸèƒ½ã€‚

---

ğŸ‰ æ­å–œï¼ä½ å·²ç»æˆåŠŸéƒ¨ç½²äº†å¸¦æœ‰å®Œæ•´è®°å½•è¿½è¸ªåŠŸèƒ½çš„é“¾ä¸Šçº¢åŒ…ç³»ç»Ÿï¼

## ğŸ“Š è®°å½•æ¨¡å—äº®ç‚¹

âœ¨ **å®Œå…¨é€æ˜**ï¼šæ‰€æœ‰æ•°æ®æ¥æºäºåŒºå—é“¾ï¼Œç¡®ä¿çœŸå®æ€§
âœ¨ **è¯¦ç»†ç»Ÿè®¡**ï¼šä»Gasè´¹ç”¨åˆ°æ”¶æ”¯åˆ†æï¼Œä¸€ç›®äº†ç„¶
âœ¨ **å®æ—¶æ›´æ–°**ï¼šæ”¯æŒäº‹ä»¶ç›‘å¬å’Œæ‰‹åŠ¨åˆ·æ–°
âœ¨ **ç”¨æˆ·å‹å¥½**ï¼šæ¸…æ™°çš„ç•Œé¢è®¾è®¡ï¼Œæ˜“äºç†è§£
âœ¨ **å¯æ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
